# ARCH1TECT Backend API

REST API backend dla ARCH1TECT events & bookings system.

## ğŸš€ Stack

- **Framework:** Flask 3.0.0
- **Database:** PostgreSQL (via SQLAlchemy)
- **Email:** Resend SMTP
- **Deployment:** Railway.app
- **WSGI Server:** Gunicorn

## ğŸ“‹ API Endpoints

### Events
- `GET /api/events` - Lista wszystkich eventÃ³w
- `GET /api/events/<id>` - Pojedynczy event
- `POST /api/events` - UtwÃ³rz event (admin)
- `PUT /api/events/<id>` - Zaktualizuj event (admin)
- `DELETE /api/events/<id>` - UsuÅ„ event (admin)

### Bookings
- `GET /api/bookings` - Lista rezerwacji
- `POST /api/bookings` - UtwÃ³rz rezerwacjÄ™ + wyÅ›lij email z calendar links
- `POST /api/bookings/<id>/approve` - ZatwierdÅº rezerwacjÄ™
- `POST /api/bookings/<id>/reject` - OdrzuÄ‡ rezerwacjÄ™

### System
- `GET /api/health` - Health check

## ğŸ”§ Local Development

### Prerequisites
- Python 3.11+
- PostgreSQL (lub uÅ¼yj Railway/Neon/Supabase)

### Setup
```bash
# Clone repo
git clone https://github.com/kozuchowskihubert/azure-club.git
cd azure-club/backend

# Create virtual environment
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Configure environment
cp .env.example .env
# Edit .env with your credentials

# Run server
python app.py
# Lub z gunicorn:
gunicorn app:app --bind 0.0.0.0:5001 --reload
```

Server bÄ™dzie dostÄ™pny na `http://localhost:5001`

### Test API
```bash
# Health check
curl http://localhost:5001/api/health

# Get events
curl http://localhost:5001/api/events

# Create booking
curl -X POST http://localhost:5001/api/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "phone": "+48123456789",
    "event_date": "2025-12-31",
    "start_time": "22:00",
    "venue": "Club HAOS",
    "city": "GdaÅ„sk",
    "event_type": "club",
    "guests": 2,
    "message": "Test booking"
  }'
```

## ğŸš‚ Railway Deployment

### Automatic Deployment
Railway automatycznie wykryje:
- `Procfile` - komenda startowa
- `requirements.txt` - dependencies
- `runtime.txt` - Python version

### Environment Variables
Ustaw w Railway Dashboard â†’ Variables:

```bash
DATABASE_URL=<auto-generated-by-railway-postgres>
MAIL_SERVER=smtp.resend.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=resend
MAIL_PASSWORD=re_your_resend_api_key
MAIL_SENDER=arch1tect@haos.fm
```

### Deploy Steps
1. Push do GitHub
2. Railway â†’ New Project â†’ Deploy from GitHub
3. Dodaj PostgreSQL database
4. Ustaw environment variables
5. Generate Domain
6. API gotowe! ğŸ‰

## ğŸ“§ Email Configuration

### Resend Setup
1. Konto: https://resend.com
2. Dodaj domenÄ™ `haos.fm`
3. Skonfiguruj DNS (SPF, DKIM, DMARC)
4. UtwÃ³rz API key
5. Dodaj do Railway variables

### Email Features
- âœ… Potwierdzenie rezerwacji
- âœ… Linki do kalendarza (Google, Outlook, Office 365)
- âœ… Apple Calendar (.ics)
- âœ… Auto-detection systemu uÅ¼ytkownika
- âœ… Email zatwierdzenia/odrzucenia

## ğŸ—„ï¸ Database Models

### Event
```python
id, name, date, time, venue, city, type, 
description, artists, price, capacity, 
image_url, status, created_at, updated_at
```

### Booking
```python
id, event_id, name, email, phone, event_date,
event_type, start_time, duration, venue, city,
guests, message, status, created_at,
calendar_event_sent, calendar_platforms,
event_title, event_location
```

## ğŸ” Security

- CORS skonfigurowany dla frontend domains
- Environment variables dla credentials
- PostgreSQL connection pooling
- Gunicorn timeout: 120s
- 2 workers dla concurrent requests

## ğŸ“Š Monitoring

### Railway Logs
```bash
# CLI
railway logs

# Dashboard
Railway â†’ Deployments â†’ View Logs
```

### Health Check
```bash
curl https://your-app.railway.app/api/health
```

Response:
```json
{
  "status": "ok",
  "message": "ARCH1TECT API is running",
  "database": "PostgreSQL"
}
```

## ğŸ› Troubleshooting

### Database Connection Issues
```bash
# Check DATABASE_URL is set
echo $DATABASE_URL

# Test connection
python -c "from app import db; db.create_all(); print('âœ… DB OK')"
```

### Email Not Sending
```bash
# Verify Resend credentials
curl https://api.resend.com/emails \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"from":"arch1tect@haos.fm","to":"test@example.com","subject":"Test","html":"Test"}'
```

### Port Issues
Railway automatycznie ustawia PORT. UÅ¼ywaj:
```python
port = int(os.environ.get('PORT', 5001))
app.run(host='0.0.0.0', port=port)
```

## ğŸ“¦ Dependencies

Core:
- Flask 3.0.0 - Web framework
- SQLAlchemy 2.0.23 - ORM
- psycopg2-binary 2.9.9 - PostgreSQL driver
- Gunicorn 21.2.0 - WSGI server

Extensions:
- Flask-CORS 4.0.0 - Cross-origin requests
- Flask-Mail 0.9.1 - Email sending
- Flask-SQLAlchemy 3.1.1 - Flask-SQLAlchemy integration
- Jinja2 3.1.6 - Email templates

## ğŸ”— Frontend Integration

Frontend powinien uÅ¼ywaÄ‡ tego URL jako `API_URL`:
```javascript
const API_URL = 'https://your-railway-app.railway.app/api';
```

Zaktualizuj w:
- `index.html`
- `admin.html`
- `test-booking.html`

## ğŸ“ License

WÅ‚aÅ›ciciel: ARCH1TECT | HAOS.fm

---

**Support:** arch1tect@haos.fm
